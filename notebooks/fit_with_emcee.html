
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/phitter_icon_16.png" sizes="16x16" rel="icon" type="image/png">
    <link href="../_static/phitter_icon_32.png" sizes="32x32" rel="icon" type="image/png">
    <link href="../_static/phitter_icon_100.png" sizes="100x100" rel="icon" type="image/png">
    <link href="../_static/phitter_icon_180.png" sizes="180x180" rel="icon" type="image/png">
    <link href="../_static/phitter_icon.svg" rel="icon" type="image/svg+xml">
    <link rel="apple-touch-icon" href="../_static/phitter_icon_180.png" sizes="180x180" type="image/png">
    <title>Tutorial: Fit binary model to observed data with emcee &#8212; Phitter 1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=372c55ee" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/fit_with_emcee';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../apidocs/index.html" />
    <link rel="prev" title="Tutorial: Fit binary model to observed data using nested sampling via UltraNest" href="fit_with_ultranest.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
<link rel="stylesheet" href="https://use.typekit.net/hxl8tqz.css">

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Phitter.svg" class="logo__image only-light" alt="Phitter 1.0 documentation - Home"/>
    <img src="../_static/Phitter_dark.svg" class="logo__image only-dark pst-js-only" alt="Phitter 1.0 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../features.html">
    Features
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../structure.html">
    Structure of Phitter
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../apidocs/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/abhimat/phitter" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../features.html">
    Features
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../structure.html">
    Structure of Phitter
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../apidocs/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/abhimat/phitter" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="simulate_model_binary.html">Tutorial: Simulate a model binary</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulate_model_binary_wMIST_star_params.html">Tutorial: Simulate a model binary using stellar parameters from an isochrone</a></li>
<li class="toctree-l1"><a class="reference internal" href="add_phot_effects.html">Tutorial: Add additional effects to simulated photometric fluxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="add_rv_effects.html">Tutorial: Add additional effects to simulated radial velocities</a></li>

<li class="toctree-l1"><a class="reference internal" href="create_mock_data.html">Simulate mock observations data for fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="fit_with_ultranest.html">Tutorial: Fit binary model to observed data using nested sampling via UltraNest</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Tutorial: Fit binary model to observed data with emcee</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../tutorials.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Tutorial: Fit binary model to observed data with emcee</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="tutorial-fit-binary-model-to-observed-data-with-emcee">
<h1>Tutorial: Fit binary model to observed data with emcee<a class="headerlink" href="#tutorial-fit-binary-model-to-observed-data-with-emcee" title="Link to this heading">#</a></h1>
<p>In this tutorial we go through the procedure of fitting observations to a binary star model using the sampling code <a class="reference external" href="https://emcee.readthedocs.io/">emcee</a>.</p>
<section id="imports-and-filter-setup">
<h2>Imports and Filter Setup<a class="headerlink" href="#imports-and-filter-setup" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">phitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">observables</span><span class="p">,</span> <span class="n">filters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">phitter.params</span><span class="w"> </span><span class="kn">import</span> <span class="n">star_params</span><span class="p">,</span> <span class="n">binary_params</span><span class="p">,</span> <span class="n">isoc_interp_params</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">phitter.calc</span><span class="w"> </span><span class="kn">import</span> <span class="n">model_obs_calc</span><span class="p">,</span> <span class="n">phot_adj_calc</span><span class="p">,</span> <span class="n">rv_adj_calc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">phitter.fit</span><span class="w"> </span><span class="kn">import</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">prior</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">phoebe</span><span class="w"> </span><span class="kn">import</span> <span class="n">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">phoebe</span><span class="w"> </span><span class="kn">import</span> <span class="n">c</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">emcee</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">corner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># The following warning regarding extinction originates from SPISEA and can be ignored.</span>
<span class="c1"># The functionality being warned about is not used by SPISEA.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/abhimat/Software/miniforge3/envs/phoebe_py38/lib/python3.8/site-packages/pysynphot/locations.py:345: UserWarning: Extinction files not found in /Volumes/Noh/models/cdbs/extinction
  warnings.warn(&#39;Extinction files not found in %s&#39; % (extdir, ))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filter_153m</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">hst_f153m_filt</span><span class="p">()</span>
<span class="n">filter_127m</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">hst_f127m_filt</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="prepare-observations-data">
<h2>Prepare observations data<a class="headerlink" href="#prepare-observations-data" title="Link to this heading">#</a></h2>
<p>Let’s read in the mock data generated in a <a class="reference internal" href="create_mock_data.html"><span class="doc std std-doc">separate example here</span></a>. Let’s assume this data is for a red giant binary star belonging to an 8 Gyr old star population at the Galactic center.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./mock_obs_table.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
    <span class="n">obs_table</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">obs_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    obs_times             obs         obs_uncs obs_types                       obs_filts                       
------------------ ------------------ -------- --------- ------------------------------------------------------
53800.714762925796 16.769110541124228    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53802.78887450278 16.569960382011555    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53804.08607971392 16.523859319835843    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53804.64136070461  16.54425287095397    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
53805.203583377115 16.551835703948942    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53805.96328097839 16.559083907180494    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
53806.315847597616 16.526208341236522    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
53806.333495717256 16.549137149396568    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
53807.488405082564  16.54357246902387    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53807.67541617193 16.512582058125357    0.015      phot &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
               ...                ...      ...       ...                                                    ...
53802.139836776325   130.228146222555     10.0    rv_pri &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53803.32979530006 114.02051863903269     10.0    rv_pri &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53804.46291200766 114.54568517998948     10.0    rv_pri &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
53813.273397048906 163.65481126090992     10.0    rv_pri &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53819.03215627737 175.28898537909566     10.0    rv_pri &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
53802.139836776325 164.33130628324724     10.0    rv_sec &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53803.32979530006 176.97897304376025     10.0    rv_sec &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53804.46291200766 190.80797816955624     10.0    rv_sec &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
53813.273397048906 129.70047968985767     10.0    rv_sec &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
 53819.03215627737  97.50308377106813     10.0    rv_sec &lt;phitter.filters.hst_f153m_filt object at 0x104bc4040&gt;
Length = 60 rows
</pre></div>
</div>
</div>
</div>
<p>We create two new <a class="reference internal" href="../apidocs/phitter/phitter.observables.html#module-phitter.observables" title="phitter.observables"><code class="xref py py-obj docutils literal notranslate"><span class="pre">phitter.observables</span></code></a> objects, one for modeling containing only the times, filters, and types of observations, and another for computing the likelihood, which will also contain the observations and associated uncertainties as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model observables object, which only contains times and types of observations</span>
<span class="n">model_observables</span> <span class="o">=</span> <span class="n">observables</span><span class="o">.</span><span class="n">observables</span><span class="p">(</span>
    <span class="n">obs_times</span><span class="o">=</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obs_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">obs_filts</span><span class="o">=</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obs_filts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">obs_types</span><span class="o">=</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obs_types&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># An observables object for the observations, used when computing likelihoods</span>
<span class="n">observations</span> <span class="o">=</span> <span class="n">observables</span><span class="o">.</span><span class="n">observables</span><span class="p">(</span>
    <span class="n">obs_times</span><span class="o">=</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obs_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">obs_uncs</span><span class="o">=</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obs_uncs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">obs_filts</span><span class="o">=</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obs_filts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">obs_types</span><span class="o">=</span><span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obs_types&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="make-stellar-parameters-and-binary-parameters-objects-for-fitting">
<h2>Make stellar parameters and binary parameters objects for fitting<a class="headerlink" href="#make-stellar-parameters-and-binary-parameters-objects-for-fitting" title="Link to this heading">#</a></h2>
<p>Now we can make a stellar parameters object that we will use to derive the stellar parameters from an isochrone while fitting. Let’s use our previous assumptions about what type of star this is: red giant in an 8 Gyr old star population.</p>
<p>We also can create a binary parameters object that will store the binary parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isoc_stellar_params_obj</span> <span class="o">=</span> <span class="n">isoc_interp_params</span><span class="o">.</span><span class="n">isoc_mist_stellar_params</span><span class="p">(</span>
    <span class="n">age</span><span class="o">=</span><span class="mf">8e9</span><span class="p">,</span>
    <span class="n">met</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">use_atm_func</span><span class="o">=</span><span class="s1">&#39;merged&#39;</span><span class="p">,</span>
    <span class="n">phase</span><span class="o">=</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span>
    <span class="n">ext_Ks</span><span class="o">=</span><span class="mf">2.2</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="mf">8e3</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span>
    <span class="n">filts_list</span><span class="o">=</span><span class="p">[</span><span class="n">filter_153m</span><span class="p">,</span> <span class="n">filter_127m</span><span class="p">],</span>
    <span class="n">ext_law</span><span class="o">=</span><span class="s1">&#39;NL18&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Make binary params objects</span>
<span class="n">bin_params</span> <span class="o">=</span> <span class="n">binary_params</span><span class="o">.</span><span class="n">binary_params</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-up-model-and-likelihood-objects">
<h2>Set up model and likelihood objects<a class="headerlink" href="#set-up-model-and-likelihood-objects" title="Link to this heading">#</a></h2>
<p>In order to carry out our fitting, we will generate two more objects: a model object that will be used to compute observables and a likelihood object that will compute the likelihood from our observations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a binary model object</span>
<span class="n">binary_model_obj</span> <span class="o">=</span> <span class="n">model_obs_calc</span><span class="o">.</span><span class="n">binary_star_model_obs</span><span class="p">(</span>
    <span class="n">model_observables</span><span class="p">,</span>
    <span class="n">use_blackbody_atm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">print_diagnostics</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Set up likelihood object for fitting parameters</span>
<span class="n">log_like_obj</span> <span class="o">=</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood_chisq</span><span class="p">(</span>
    <span class="n">observations</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-up-log-likelihood-log-prior-and-log-probability-functions-for-emcee">
<h2>Set up log likelihood, log prior, and log probability functions for emcee<a class="headerlink" href="#set-up-log-likelihood-log-prior-and-log-probability-functions-for-emcee" title="Link to this heading">#</a></h2>
<p>Now we need to write a function that will be used by emcee to calculate the log likelihood for a given set of fit parameters.</p>
<p>For our fitting, we’ll fit our data to eight parameters:</p>
<ol class="arabic simple">
<li><p>radius of star 1</p></li>
<li><p>radius of star 2</p></li>
<li><p>binary orbital period</p></li>
<li><p>binary inclination</p></li>
<li><p>system t0</p></li>
<li><p>binary CoM velocity</p></li>
<li><p>extinction in F153M passband</p></li>
<li><p>extinction law alpha</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">emcee_log_like</span><span class="p">(</span><span class="n">model_params</span><span class="p">):</span>
    <span class="p">(</span>
        <span class="n">star1_radius</span><span class="p">,</span>
        <span class="n">star2_radius</span><span class="p">,</span>
        <span class="n">bin_period</span><span class="p">,</span>
        <span class="n">bin_inc</span><span class="p">,</span>
        <span class="n">bin_t0</span><span class="p">,</span>
        <span class="n">bin_rv_com</span><span class="p">,</span>
        <span class="n">ext_153m</span><span class="p">,</span>
        <span class="n">ext_alpha</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">model_params</span>
    
    <span class="c1"># Obtain stellar params by interpolating along the isochrone</span>
    <span class="n">star1_params</span> <span class="o">=</span> <span class="n">isoc_stellar_params_obj</span><span class="o">.</span><span class="n">interp_star_params_rad</span><span class="p">(</span>
        <span class="n">star1_radius</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">star2_params</span> <span class="o">=</span> <span class="n">isoc_stellar_params_obj</span><span class="o">.</span><span class="n">interp_star_params_rad</span><span class="p">(</span>
        <span class="n">star2_radius</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Set binary params</span>
    <span class="n">bin_params</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">bin_period</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span>
    <span class="n">bin_params</span><span class="o">.</span><span class="n">inc</span> <span class="o">=</span> <span class="n">bin_inc</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
    <span class="n">bin_params</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="n">bin_t0</span>
    
    <span class="c1"># Run binary model</span>
    <span class="n">modeled_observables</span> <span class="o">=</span> <span class="n">binary_model_obj</span><span class="o">.</span><span class="n">compute_obs</span><span class="p">(</span>
        <span class="n">star1_params</span><span class="p">,</span> <span class="n">star2_params</span><span class="p">,</span> <span class="n">bin_params</span><span class="p">,</span>
        <span class="n">num_triangles</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Check for situation where binary model fails</span>
    <span class="c1"># (i.e., unphysical conditions not able to be modeled)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">modeled_observables</span><span class="o">.</span><span class="n">obs_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="c1"># Apply distance modulus</span>
    <span class="c1"># (We&#39;re assuming we know the distance, but this can be a fit parameter as well)</span>
    <span class="n">modeled_observables</span> <span class="o">=</span> <span class="n">phot_adj_calc</span><span class="o">.</span><span class="n">apply_distance_modulus</span><span class="p">(</span>
        <span class="n">modeled_observables</span><span class="p">,</span>
        <span class="mf">7.971e3</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Apply extinction</span>
    <span class="n">modeled_observables</span> <span class="o">=</span> <span class="n">phot_adj_calc</span><span class="o">.</span><span class="n">apply_extinction</span><span class="p">(</span>
        <span class="n">modeled_observables</span><span class="p">,</span>
        <span class="mf">2.2</span><span class="p">,</span> <span class="n">filter_153m</span><span class="p">,</span>
        <span class="n">ext_153m</span><span class="p">,</span>
        <span class="n">isoc_red_law</span><span class="o">=</span><span class="s1">&#39;NL18&#39;</span><span class="p">,</span>
        <span class="n">ext_alpha</span><span class="o">=</span><span class="n">ext_alpha</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Add RV center of mass velocity</span>
    <span class="n">modeled_observables</span> <span class="o">=</span> <span class="n">rv_adj_calc</span><span class="o">.</span><span class="n">apply_com_velocity</span><span class="p">(</span>
        <span class="n">modeled_observables</span><span class="p">,</span>
        <span class="n">bin_rv_com</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Compute and return log likelihood</span>
    <span class="n">log_like</span> <span class="o">=</span> <span class="n">log_like_obj</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">modeled_observables</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">log_like</span>
</pre></div>
</div>
</div>
</div>
<p>We also need a function for the log prior and a log prob function for emcee. We can create them in the following way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">emcee_log_prior</span><span class="p">(</span><span class="n">model_params</span><span class="p">):</span>
    <span class="p">(</span>
        <span class="n">star1_radius</span><span class="p">,</span>
        <span class="n">star2_radius</span><span class="p">,</span>
        <span class="n">bin_period</span><span class="p">,</span>
        <span class="n">bin_inc</span><span class="p">,</span>
        <span class="n">bin_t0</span><span class="p">,</span>
        <span class="n">bin_rv_com</span><span class="p">,</span>
        <span class="n">ext_153m</span><span class="p">,</span>
        <span class="n">ext_alpha</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">model_params</span>
    
    <span class="n">s1_checks</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">&lt;</span> <span class="n">star1_radius</span> <span class="o">&lt;</span> <span class="mf">25.0</span>
    
    <span class="n">s2_checks</span> <span class="o">=</span> <span class="mf">8.0</span> <span class="o">&lt;</span> <span class="n">star2_radius</span> <span class="o">&lt;</span> <span class="mf">15.0</span>
    
    <span class="n">bin_param_checks</span> <span class="o">=</span> <span class="mf">22.0</span> <span class="o">&lt;</span> <span class="n">bin_period</span> <span class="o">&lt;</span> <span class="mf">28.0</span> <span class="ow">and</span>\
        <span class="mf">40.0</span> <span class="o">&lt;</span> <span class="n">bin_inc</span> <span class="o">&lt;</span> <span class="mf">140.0</span> <span class="ow">and</span>\
        <span class="mf">53_795.0</span> <span class="o">&lt;</span> <span class="n">bin_t0</span> <span class="o">&lt;</span> <span class="mf">53_805.0</span> <span class="ow">and</span>\
        <span class="mf">100.0</span> <span class="o">&lt;</span> <span class="n">bin_rv_com</span> <span class="o">&lt;</span> <span class="mf">200.0</span>
    
    <span class="n">ext_checks</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">&lt;</span> <span class="n">ext_153m</span> <span class="o">&lt;</span> <span class="mf">6.0</span> <span class="ow">and</span>\
        <span class="mf">2.17</span> <span class="o">&lt;</span> <span class="n">ext_alpha</span> <span class="o">&lt;</span> <span class="mf">2.29</span>
    
    <span class="k">if</span> <span class="n">s1_checks</span> <span class="ow">and</span> <span class="n">s2_checks</span> <span class="ow">and</span> <span class="n">bin_param_checks</span> <span class="ow">and</span> <span class="n">ext_checks</span><span class="p">:</span>
        <span class="n">log_prior</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="k">return</span> <span class="n">log_prior</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="k">def</span><span class="w"> </span><span class="nf">emcee_log_prob</span><span class="p">(</span><span class="n">model_params</span><span class="p">):</span>
    <span class="n">lp</span> <span class="o">=</span> <span class="n">emcee_log_prior</span><span class="p">(</span><span class="n">model_params</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lp</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="k">return</span> <span class="n">lp</span> <span class="o">+</span> <span class="n">emcee_log_like</span><span class="p">(</span><span class="n">model_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s test out our <code class="docutils literal notranslate"><span class="pre">emcee_log_prob()</span></code> function on some mock binary parameters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_params</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mf">18.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span>
    <span class="mf">23.</span><span class="p">,</span> <span class="mf">85.</span><span class="p">,</span>
    <span class="mf">53_801.</span><span class="p">,</span>
    <span class="mf">140.</span><span class="p">,</span>
    <span class="mf">4.4</span><span class="p">,</span> <span class="mf">2.22</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">log_like_test</span> <span class="o">=</span> <span class="n">emcee_log_prob</span><span class="p">(</span><span class="n">test_params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;log prob from test parameters = </span><span class="si">{</span><span class="n">log_like_test</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Since we simulated these mock data ourselves, we know what the &quot;truth&quot; is here. So we can check that as well</span>
<span class="n">truth_params</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mf">15.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">,</span>
    <span class="mf">25.</span><span class="p">,</span> <span class="mf">75.</span><span class="p">,</span>
    <span class="mf">53_800.</span><span class="p">,</span>
    <span class="mf">150.</span><span class="p">,</span>
    <span class="mf">4.5</span><span class="p">,</span> <span class="mf">2.23</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">log_like_truth</span> <span class="o">=</span> <span class="n">emcee_log_prob</span><span class="p">(</span><span class="n">truth_params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;log prob from &quot;truth&quot; parameters = </span><span class="si">{</span><span class="n">log_like_truth</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>log prob from test parameters = -42081.556
log prob from &quot;truth&quot; parameters = -41.971
</pre></div>
</div>
</div>
</div>
</section>
<section id="initialize-walker-positions">
<h2>Initialize walker positions<a class="headerlink" href="#initialize-walker-positions" title="Link to this heading">#</a></h2>
<p>Before we start sampling with emcee, we need to initialize the walker’s starting positions (e.g., see <a class="reference external" href="https://emcee.readthedocs.io/en/stable/tutorials/line/">this emcee tutorial</a>). We can make a “Gaussian ball” around an initial rough guess (which I’ve intentionally made slightly different from the “truth”!).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_params</span><span class="p">)</span>
<span class="n">n_walkers</span> <span class="o">=</span> <span class="n">n_params</span> <span class="o">*</span> <span class="mi">10</span>

<span class="n">p0</span> <span class="o">=</span> <span class="p">[(</span>
    <span class="mi">14</span> <span class="o">+</span> <span class="mf">1.e0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span>
    <span class="mi">11</span> <span class="o">+</span> <span class="mf">1.e0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span>
    <span class="mi">24</span> <span class="o">+</span> <span class="mf">1.e0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span>
    <span class="mf">90.</span> <span class="o">+</span> <span class="p">((</span><span class="mi">10</span> <span class="o">+</span> <span class="mf">5e0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">())</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)),</span>
    <span class="mi">53_801</span> <span class="o">+</span> <span class="mf">1.e0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span>
    <span class="mf">140.</span> <span class="o">+</span> <span class="mf">5.e0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span>
    <span class="mf">4.4</span> <span class="o">+</span> <span class="mf">1.e-1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span>
    <span class="mf">2.22</span> <span class="o">+</span> <span class="mf">1.e-2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span>
<span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_walkers</span><span class="p">)]</span>

<span class="c1"># Check a few starting samples to see where parameters are</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(14.47892920724483, 11.276727701200546, 25.217452017965808, 103.48342064481523, 53800.58894731225, 137.02612844948186, 4.503419215975494, 2.224099784191553)
(12.716566273109867, 10.06382840081517, 23.69835325196324, 101.22917370641278, 53797.90622013221, 141.03897907531967, 4.421230462762748, 2.2173935687465214)
(14.418872392083427, 10.793388043866987, 24.232174875833678, 101.69675576674705, 53801.16558560297, 137.18622203662952, 4.3339440786974, 2.2351612537495344)
(14.010365967329573, 11.423554414138437, 24.002556052040834, 90.51884083668568, 53801.5536072747, 142.75122324998884, 4.509535921168592, 2.202097777445174)
(14.821334119595459, 11.109939992296658, 24.8031140555109, 78.10172166175022, 53800.46863926781, 141.68317432837793, 4.324163346702092, 2.2204467623463158)
(13.534212852292521, 11.688743768651523, 23.257138599160733, 76.30425529906718, 53801.220011747835, 132.05311728831578, 4.354545784329817, 2.2140482543352538)
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-emcee-sampler">
<h2>Run emcee sampler<a class="headerlink" href="#run-emcee-sampler" title="Link to this heading">#</a></h2>
<p>The syntax below shows how to run the sampler. However for speed, I wrote a <a class="reference download internal" download="" href="../_downloads/5152e14d00d42659d5c7e6210bf03337/fit_with_emcee.py"><span class="xref download myst">separate script</span></a> that can be parallelized with Python multiprocessing.</p>
<p>emcee can resume from previous runs and the code block below can pick up on the samples from the separate parallelized script.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_steps</span><span class="o">=</span><span class="mi">1000</span>

<span class="c1"># Set up backend to save run</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;emcee_chains.h5&#39;</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">HDFBackend</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># Set up sampler</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span>
    <span class="n">n_walkers</span><span class="p">,</span> <span class="n">n_params</span><span class="p">,</span> <span class="n">emcee_log_prob</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> 
<span class="p">)</span>

<span class="c1"># Determine number of steps completed so far</span>
<span class="n">n_steps</span><span class="o">=</span><span class="mi">500</span>
<span class="n">n_steps_completed</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">iteration</span>
<span class="n">n_steps_remaining</span> <span class="o">=</span> <span class="n">n_steps</span> <span class="o">-</span> <span class="n">n_steps_completed</span>

<span class="k">if</span> <span class="n">n_steps_completed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">n_steps_remaining</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">n_steps_remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_steps_remaining</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examine-the-fit-results">
<h2>Examine the fit results<a class="headerlink" href="#examine-the-fit-results" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_params</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;star1_radius&#39;</span><span class="p">,</span>
    <span class="s1">&#39;star2_radius&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bin_period&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bin_inc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bin_t0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bin_rv_com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ext_153m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ext_alpha&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_params</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">],</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Step Number&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6cc16be6b81c2fe9ab60969d7730f4b447a7391ae4cc160191ad476d608bac33.png" src="../_images/6cc16be6b81c2fe9ab60969d7730f4b447a7391ae4cc160191ad476d608bac33.png" />
</div>
</div>
<p>Compute an autocorrelation time to estimate number of steps to discard for burn-in and how many steps to “thin” the chains by.</p>
<p>Ideally we should run the sampler longer, but we will ignore the warning for this tutorial! 😅</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_autocorr_time</span><span class="p">(</span><span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tau: </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">discard</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">thin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of steps to discard for burn-in: </span><span class="si">{</span><span class="n">discard</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of steps for thinning chains: </span><span class="si">{</span><span class="n">thin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The chain is shorter than 50 times the integrated autocorrelation time for 8 parameter(s). Use this estimate with caution and run a longer chain!
N/50 = 20;
tau: [ 95.00843434 111.54112011  85.9615038   81.58055751  59.77598562
  97.63162579 106.75346184  97.26613673]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tau: [ 95.00843434 111.54112011  85.9615038   81.58055751  59.77598562
  97.63162579 106.75346184  97.26613673]
Number of steps to discard for burn-in: 223
Number of steps for thinning chains: 56
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flat_samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">discard</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flat_samples</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1040, 8)
</pre></div>
</div>
</div>
</div>
<p>We can make a corner plot to compare our estimates for each parameter. We’ll also put in the “truth” values in here (shown as blue lines), corresponding to the value of each parameter with which we generated the mock data.</p>
<p>The fit recovers the generated parameters. Interestingly, the solution appears to be multimodal: in particular, there are other values for the period or stellar radii than the “truth” which appear to give plausible solutions!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
    <span class="n">flat_samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="n">truth_params</span><span class="p">,</span>
    <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.15866</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8413</span><span class="p">],</span>
    <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Too few points to create valid contours
WARNING:root:Too few points to create valid contours
</pre></div>
</div>
<img alt="../_images/cc3def94b21e2d123e723f25192654659523b4dfa69ed4f749118ac6d47243fa.png" src="../_images/cc3def94b21e2d123e723f25192654659523b4dfa69ed4f749118ac6d47243fa.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="fit_with_ultranest.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tutorial: Fit binary model to observed data using nested sampling via UltraNest</p>
      </div>
    </a>
    <a class="right-next"
       href="../apidocs/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API Reference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-filter-setup">Imports and Filter Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-observations-data">Prepare observations data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-stellar-parameters-and-binary-parameters-objects-for-fitting">Make stellar parameters and binary parameters objects for fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-model-and-likelihood-objects">Set up model and likelihood objects</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-log-likelihood-log-prior-and-log-probability-functions-for-emcee">Set up log likelihood, log prior, and log probability functions for emcee</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-walker-positions">Initialize walker positions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-emcee-sampler">Run emcee sampler</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-the-fit-results">Examine the fit results</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/notebooks/fit_with_emcee.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Abhimat K. Gautam.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>